<Page x:Class="TwinCATModuleTransfer.Views.ExportPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:vm="clr-namespace:TwinCATModuleTransfer.ViewModels">
    <Page.DataContext>
        <vm:ExportViewModel/>
    </Page.DataContext>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top inputs -->
        <Grid Grid.Row="0" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <StackPanel Orientation="Vertical" Grid.Column="0" Margin="0,0,10,0">
                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <TextBlock Text="Solution (.sln):" VerticalAlignment="Center" Width="130"/>
                    <TextBox Text="{Binding SolutionPath, UpdateSourceTrigger=PropertyChanged}" MinWidth="500" />
                    <Button Content="…" Margin="8,0,0,0" Padding="12,3"
                  Command="{Binding BrowseSolutionCommand}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <TextBlock Text="Start in:" VerticalAlignment="Center" Width="130"/>
                    <ComboBox SelectedItem="{Binding DteHost}"
                    ItemsSource="{Binding DteHosts}"
                    MinWidth="240"/>
                    <TextBlock Text="  (XAE Shell / Visual Studio)" VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <TextBlock Text="Basisknoten:" VerticalAlignment="Center" Width="130"/>
                    <TextBox Text="{Binding BaseTreePath}" MinWidth="500"
                   ToolTip="z. B. TIID^Device 1 (EtherCAT)^-KF002 (EK1101)^-KF005 (EK1122)"/>
                    <Button Content="Baum laden" Margin="8,0,0,0" Padding="12,3"
                  Command="{Binding LoadTreeCommand}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal">
                    <CheckBox Content="Links/Mapping sichern" IsChecked="{Binding SaveMappings}"/>
                    <CheckBox Content="NC‑Achsen aufnehmen" Margin="16,0,0,0" IsChecked="{Binding IncludeNcAxes}"/>
                </StackPanel>
            </StackPanel>

            <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Exportordner:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox Text="{Binding ExportFolder}" MinWidth="300"/>
                    <Button Content="…" Margin="8,0,0,0" Padding="12,3"
                  Command="{Binding BrowseExportFolderCommand}"/>
                </StackPanel>
            </StackPanel>
        </Grid>

        <!-- Tree -->
        <Border Grid.Row="1" BorderBrush="#DDD" BorderThickness="1" Padding="8">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <TreeView ItemsSource="{Binding Tree}"
                  SelectedItemChanged="TreeView_SelectedItemChanged">
                    <TreeView.Resources>
                        <HierarchicalDataTemplate DataType="{x:Type vm:SelectionTreeItem}"
                                      ItemsSource="{Binding Children}">
                            <StackPanel Orientation="Horizontal">
                                <CheckBox IsChecked="{Binding IsChecked, Mode=TwoWay}" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding DisplayName}" Margin="6,0,0,0"/>
                            </StackPanel>
                        </HierarchicalDataTemplate>
                    </TreeView.Resources>
                </TreeView>
            </ScrollViewer>
        </Border>

        <!-- Actions -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Content="Alles markieren" Margin="0,0,10,0" Command="{Binding CheckAllCommand}"/>
            <Button Content="Exportieren" Padding="16,6" Command="{Binding ExportCommand}"/>
        </StackPanel>
    </Grid>
</Page>